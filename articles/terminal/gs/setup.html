<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Setup </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Setup ">
      
      
      <link rel="icon" href="../../../images/favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="../../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/perpetualintelligence/docs/blob/main/docfx_project/articles/terminal/gs/setup.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../images/logo.ico" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="setup">Setup</h1>

<p>Ensure you have your license file ready. Follow these steps to set up your terminal application with the <code>OneImlx.Terminal</code> framework.</p>
<h2 id="test-application">Test Application</h2>
<p>Our test application demonstrates the <code>OneImlx.Terminal</code> framework. It's suitable for learning and building terminal applications.</p>
<h3 id="summary">Summary</h3>
<ol>
<li>Browse <a href="https://github.com/perpetualintelligence/terminal/apps">test application</a></li>
<li>Clone the <code>apps</code> folder</li>
<li>Replace our internal development license with your demo or commercial license.</li>
<li>Remove the conditional <code>&lt;ProjectReference&gt;</code> in .csproj and use NuGet <code>&lt;PackageReference&gt;</code>.</li>
<li>Build and test the code</li>
</ol>
<h2 id="details">Details</h2>
<h3 id="1-install-nuget-packages">1. Install NuGet Packages</h3>
<p>You install the framework through NuGet packages. The core functionality is available via the <code>OneImlx.Terminal</code> package. For scenarios requiring secured command execution, the <code>OneImlx.Terminal.Authentication</code> package extends the framework with authentication capabilities. You may choose either package based on your needs.</p>
<p><a href="https://www.nuget.org/packages/OneImlx.Terminal"><img src="https://img.shields.io/nuget/vpre/OneImlx.Terminal?label=OneImlx.Terminal" alt="NuGet"></a>
<a href="https://www.nuget.org/packages/OneImlx.Terminal.Authentication"><img src="https://img.shields.io/nuget/vpre/OneImlx.Terminal?label=OneImlx.Terminal.Authentication" alt="NuGet"></a></p>
<p>Apart from that you will need the following NuGet packages:</p>
<p><a href="https://www.nuget.org/packages/Microsoft.Extensions.Hosting"><img src="https://img.shields.io/nuget/v/Microsoft.Extensions.Hosting?label=Microsoft.Extensions.Hosting" alt="NuGet"></a></p>
<blockquote>
<p><strong>Note</strong>: Remove the entire <code>DEV CONFIG:</code> from the the .csproj file and add our NuGet package directly. The <code>&lt;ProjectReference&gt;</code> is for our internal development.</p>
</blockquote>
<pre><code>    &lt;!--
        DEV CONFIG: REMOVE THIS SECTION IN YOUR APP AND ONLY ADD NUGET PACKAGE REFERENCE
    --&gt;
    &lt;Choose&gt;
        &lt;When Condition=&quot;'$(PI_CI_REFERENCE)'=='cross'&quot;&gt;
            &lt;ItemGroup&gt;
                &lt;ProjectReference Include=&quot;..\..\src\OneImlx.Terminal.Authentication\OneImlx.Terminal.Authentication.csproj&quot; /&gt;
            &lt;/ItemGroup&gt;
        &lt;/When&gt;
        &lt;Otherwise&gt;
            &lt;ItemGroup&gt;
                &lt;PackageReference Include=&quot;OneImlx.Terminal.Authentication&quot; Version=&quot;5.10.1-rc.114243041&quot; /&gt;
            &lt;/ItemGroup&gt;
        &lt;/Otherwise&gt;
    &lt;/Choose&gt;
</code></pre>
<h3 id="2-add-hosted-service">2. Add Hosted Service</h3>
<p>The <a class="xref" href="../../../api/OneImlx.Terminal.Hosting.TerminalHostedService.html">TerminalHostedService</a> is a hosted service that manages terminal lifetime, performs licensing and configuration checks, and enables terminal UX customization.</p>
<p>The below image shows the default console view when you run the test application.
<img src="../../../images/terminal/apps/add-hosted-service.png" alt="HostedService"></p>
<p>You can customize the terminal behavior by overriding the methods from <a class="xref" href="../../../api/OneImlx.Terminal.Hosting.TerminalHostedService.html">TerminalHostedService</a>.</p>
<pre><code>using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
using OneImlx.Terminal.Configuration.Options;
using OneImlx.Terminal.Hosting;
using OneImlx.Terminal.Licensing;
using OneImlx.Terminal.Runtime;

namespace OneImlx.Terminal.Apps.TestApp
{
    /// &lt;summary&gt;
    /// The &lt;see cref=&quot;TerminalHostedService&quot;/&gt; for the test app.
    /// &lt;/summary&gt;
    public sealed class TestAppHostedService : TerminalHostedService
    {
        /// &lt;summary&gt;
        /// Initializes a new instance.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;serviceProvider&quot;&gt;The DI service provider.&lt;/param&gt;
        /// &lt;param name=&quot;options&quot;&gt;The terminal configuration options.&lt;/param&gt;
        /// &lt;param name=&quot;terminalConsole&quot;&gt;The terminal console.&lt;/param&gt;
        /// &lt;param name=&quot;logger&quot;&gt;The logger.&lt;/param&gt;
        public TestAppHostedService(
            IServiceProvider serviceProvider,
            TerminalOptions options,
            ITerminalConsole terminalConsole,
            ILogger&lt;TerminalHostedService&gt; logger) : base(serviceProvider, options, terminalConsole, logger)
        {
        }

        /// &lt;summary&gt;
        /// Perform custom configuration option checks at startup.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;options&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected override Task CheckHostApplicationConfigurationAsync(TerminalOptions options)
        {
            return Task.CompletedTask;
        }

        /// &lt;summary&gt;
        /// The &lt;see cref=&quot;IHostApplicationLifetime.ApplicationStarted&quot;/&gt; handler.
        /// &lt;/summary&gt;
        protected override void OnStarted()
        {
            // These are async calls, but we are blocking here for as the  of the test.
            TerminalConsole.WriteLineAsync(&quot;Application started on {0}.&quot;, DateTime.UtcNow.ToLocalTime().ToString()).Wait();
        }

        /// &lt;summary&gt;
        /// The &lt;see cref=&quot;IHostApplicationLifetime.ApplicationStopped&quot;/&gt; handler.
        /// &lt;/summary&gt;
        protected override void OnStopped()
        {
            TerminalConsole.WriteLineColorAsync(ConsoleColor.Red, &quot;Application stopped on {0}.&quot;, DateTime.UtcNow.ToLocalTime().ToString()).Wait();
        }

        /// &lt;summary&gt;
        /// The &lt;see cref=&quot;IHostApplicationLifetime.ApplicationStopping&quot;/&gt; handler.
        /// &lt;/summary&gt;
        protected override void OnStopping()
        {
            TerminalConsole.WriteLineAsync(&quot;Stopping application...&quot;).Wait();
        }

        /// &lt;summary&gt;
        /// Print &lt;c&gt;cli&lt;/c&gt; terminal header.
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected override async Task PrintHostApplicationHeaderAsync()
        {
            await TerminalConsole.WriteLineAsync(&quot;---------------------------------------------------------------------------------------------&quot;);
            await TerminalConsole.WriteLineAsync(&quot;Copyright (c) Test App. All Rights Reserved.&quot;);
            await TerminalConsole.WriteLineAsync(&quot;For license, terms, and data policies, go to:&quot;);
            await TerminalConsole.WriteLineAsync(&quot;https://mytestapp.com&quot;);
            await TerminalConsole.WriteLineAsync(&quot;---------------------------------------------------------------------------------------------&quot;);

            await TerminalConsole.WriteLineAsync(&quot;Starting application...&quot;);
        }

        /// &lt;summary&gt;
        /// Print host application licensing information.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;license&quot;&gt;The extracted license.&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        protected override Task PrintHostApplicationLicensingAsync(License license)
        {
            // Print custom licensing info or remove it completely.
            return base.PrintHostApplicationLicensingAsync(license);
        }
    }
}
</code></pre>
<h3 id="3-setup-programcs">3. Setup Program.cs</h3>
<p>The Main method in Program.cs sets up the <code>OneImlx.Terminal</code> framework and initiates the default console router, which then asynchronously processes and executes user-issued commands. It also configures cancellation tokens to terminate specific commands or the entire application as needed.</p>
<pre><code>private static async Task Main(string[] args)
{
    // Allow cancellation for the entire terminal or individual commands.
    CancellationTokenSource terminaTokenSource = new();
    CancellationTokenSource commandTokenSource = new();

    // Setup and start the host builder.
    // Note: The host should only start, the terminal framework will run the router separately.
    IHostBuilder hostBuilder = CreateHostBuilder(args);
    hostBuilder.ConfigureServices(ConfigureServicesDelegate);
    hostBuilder.ConfigureLogging(ConfigureLoggingDelegate);
    IHost host = hostBuilder.Start();

    // Setup the terminal context and run the console router indefinitely.
    TerminalStartContext terminalStartContext = new(TerminalStartMode.Console, terminaTokenSource.Token, commandTokenSource.Token);
    TerminalConsoleRouterContext consoleRouterContext = new(terminalStartContext);
    await host.RunTerminalRouterAsync&lt;TerminalConsoleRouter, TerminalConsoleRouterContext&gt;(consoleRouterContext);
}
</code></pre>
<blockquote>
<p>Note:
You can also configure your terminal as a server that employs TCP or UDP routers to process and execute commands in a service-to-service architecture.</p>
</blockquote>
<h3 id="4-configure-services-and-options">4. Configure Services and Options</h3>
<p>The <code>OneImlx.Terminal</code> framework leverages the modern Dependency Injection (DI) and Options pattern to streamline setup and customization.</p>
<h4 id="configure-logging">Configure Logging</h4>
<p><code>ConfigureLoggingDelegate</code> acts as a customizable method for setting up logging. Below is an example showing how to configure <a href="https://serilog.net/">Serilog</a> as the logging solution.</p>
<pre><code>private static void ConfigureLoggingDelegate(HostBuilderContext context, ILoggingBuilder builder)
{
    // Clear all providers
    builder.ClearProviders();

    // Configure logging of your choice, here we are configuring Serilog
    var loggerConfig = new LoggerConfiguration();
    loggerConfig.MinimumLevel.Error();
    loggerConfig.WriteTo.Console();
    Log.Logger = loggerConfig.CreateLogger();
    builder.AddSerilog(Log.Logger);
}
</code></pre>
<h4 id="configure-services">Configure Services</h4>
<p><code>ConfigureServicesDelegate</code> acts as a customizable method for integrating all necessary services for your terminal application. To specifically configure the <code>OneImlx.Terminal</code> framework, utilize the <code>ConfigureOneImlxTerminal</code> method.</p>
<pre><code>private static void ConfigureServicesDelegate(HostBuilderContext context, IServiceCollection services)
{
    // Disable hosting status message
    services.Configure&lt;ConsoleLifetimeOptions&gt;(options =&gt;
    {
        options.SuppressStatusMessages = true;
    });

    // Configure OneImlx.Terminal services
    ConfigureOneImlxTerminal(services);
            
    // Configure other services
}
</code></pre>
<h4 id="configure-framework">Configure Framework</h4>
<p><code>ConfigureOneImlxTerminal</code> configures the <code>OneImlx.Terminal</code> framework for console mode with a demo license. It registers a hosted service to manage the terminal's lifecycle, initializes HTTP client for demo license, and sets the licensed application identifier, license file path, and command prompt symbol.</p>
<blockquote>
<p><strong>Note:</strong> Please ensure you set your application identifier and the path to your demo license.</p>
</blockquote>
<p>For more information, see all the supported <a href="../configuration/services.html">terminal services</a>, <a href="../configuration/options.html">configuration options</a> and <a href="../concepts/routers.html">terminal routers</a></p>
<pre><code>private static void ConfigureOneImlxTerminal(IServiceCollection collection)
{
    // Configure the hosted service
    collection.AddHostedService&lt;TestAppHostedService&gt;();

    // We are using online license so configure HTTP client
    collection.AddHttpClient(&quot;demo-http&quot;);

    // Specific your demo or commercial license file.
    // Note: Replace with your license file.
    ITerminalBuilder terminalBuilder = collection.AddTerminalConsole&lt;TerminalInMemoryCommandStore, TerminalUnicodeTextHandler, TerminalHelpConsoleProvider, TerminalSystemConsole&gt;(new TerminalUnicodeTextHandler(),
        options =&gt;
        {
            options.Id = TerminalIdentifiers.TestApplicationId;
            options.Licensing.LicenseFile = &quot;C:\\lic\\demo.json&quot;;
            options.Router.Caret = &quot;&gt; &quot;;
        }
    );

    // Add commands using declarative syntax
    terminalBuilder.AddDeclarativeAssembly&lt;TestRunner&gt;();
}
</code></pre>
<h3 id="5-add-descriptors-and-runners">5. Add Descriptors and Runners</h3>
<p>The test application includes a Runners folder that defines all the runners. Each runner defines a command descriptor, arguments, and options or flags.</p>
<p>You can use declarative syntax to define the descriptor's attributes directly on each command runner, or you can use explicit extension methods to register the command descriptor and runners.</p>
<p><img src="../../../images/terminal/apps/runners.png" alt="Runners"></p>
<h3 id="6-start-terminal-router">6. Start Terminal Router</h3>
<p>Building and launching the test application with the terminal console router completes the setup, a task already accomplished in the Main method.</p>
<p>The following image displays executing a test command from the user-entered command string.</p>
<p><img src="../../../images/terminal/apps/start-router.png" alt="StartRouter"></p>
<h3 id="7-stop-terminal-router">7. Stop Terminal Router</h3>
<p>You have several methods to stop the terminal router, either explicitly or programmatically:</p>
<ul>
<li>Send the standard <code>CTRL+C</code> signal to the hosted service/console.</li>
<li>Define an <code>exit</code> command that triggers cancellation.</li>
<li>Issue a cancellation token programmatically from within the application.</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/perpetualintelligence/docs/blob/main/docfx_project/articles/terminal/gs/setup.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          Copyright &copy; 2019-2025. Perpetual Intelligence&reg; L.L.C. All Rights Reserved.
        </div>
      </div>
    </footer>
  </body>
</html>
