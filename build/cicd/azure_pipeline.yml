# Variable 'PI_LOCAL_CADENCE' was defined in the Variables tab
# Variable Group 'Cadence Variables' was defined in the Variables tab
# Agent Queue 'Azure Pipelines' was used with unrecognized Agent Specification, vmImage property must be specified to determine image - https://docs.microsoft.com/en-us/azure/devops/pipelines/agents/hosted?view=azure-devops&tabs=yaml#software
name: $(PI_LIBRARY_MAJORVERSION).$(PI_LIBRARY_MINORVERSION).$(PI_LIBRARY_BUILDVERSION)-$(PI_LOCAL_CADENCE).$(Date:yyMMdd)$(Rev:rr)
resources:
  repositories:
  - repository: self
    type: github
    ref: main
  - repository: protocols
    type: github
    ref: main
    name: perpetualintelligence/protocols
jobs:
- job: BuildDocs
  displayName: Hosted Windows
  pool:
    name: Azure Pipelines
  steps:
  - checkout: self
  - checkout: protocols
    clean: true
  - task: UseDotNet@2
    displayName: Use .NET Core
    inputs:
      useGlobalJson: true
  - task: PowerShell@2
    displayName: Set Pipeline Cadence
    inputs:
      targetType: inline
      script: >-
        # See https://docs.microsoft.com/en-us/azure/devops/pipelines/process/variables?view=azure-devops&tabs=classic%2Cbatch for variable expansion

        # Set the PI_LIBRARY_CADENCE to either preview, rc or release. This variable is used in downstream *.csproj to restore the NuGet references.

        # PI_TASKGROUP_CADENCE is passed by the parent pipeline


        Write-Host "##vso[task.setvariable variable=PI_LIBRARY_CADENCE]$(PI_LOCAL_CADENCE)"
      failOnStderr: true
  - task: PowerShell@2
    displayName: Enumerate
    inputs:
      targetType: inline
      script: Get-ChildItem -Path $(Build.ArtifactStagingDirectory) --
...

